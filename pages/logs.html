<style>
    img {
        max-height: 500px;
        max-width: 100%;
    }
</style>
<div id="postbox"></div>
<script>
    function displayPost(){
        url = window.location.href;
        request = url.substring(url.lastIndexOf('/') + 1).split('?=')[1];
        console.log(request);
        fetchposts();
    }
    function fetchposts() {
        fetch(`https://kitty.meadow.cafe/api/v1/get-user-posts-messages/25`)
            .then(res => res.json())
            .then(resJSON => {
            // interact with resJSON here
            console.log(resJSON);
            let posts = resJSON;
            posts.reverse()
            let postbox = document.getElementById("postbox");
            let postcontent = null;
            for (let i = 0; i < posts.length; i++) {
                let post = posts[i];
                if (post.Slug == request){
                    postcontent = document.createElement("div");
                    postcontent.innerHTML = "<h1>" + post.Title + "</h1>";
                    postcontent.innerHTML += markdownParser(post.Body);
                    postbox.appendChild(postcontent);
                }
            }
            if(postcontent == null){
                let postcontent = document.createElement("div");
                postcontent.innerHTML = "<h1>Post Not Found</h1>The post you are looking for does not exist.";
                postbox.appendChild(postcontent);
            }
        });
    }
    const markdownParser = (text) => {
        const toHTML = text
            .replace(/^### (.*$)/gim, '<h3>$1</h3>') // h3 tag
            .replace(/^## (.*$)/gim, '<h2>$1</h2>') // h2 tag
            .replace(/^# (.*$)/gim, '<h1>$1</h1>') // h1 tag
            .replace(/\*\*(.*)\*\*/gim, '<b>$1</b>') // bold text
            .replace(/\*(.*)\*/gim, '<i>$1</i>') // italic text
            .replace(/\!\[(.*?)\]\((.*?)\)/gim, '<img alt="$1" src="$2">')
            .replace(/\[(.*?)\]\((.*?)\)/gim, '<a href="$2" target="_blank">$1</a>')
            .replace(/```(.*?)```/gim, '<pre><code>$1</code></pre>')
            .replace(/\r\n/gm, '<br>');

        return toHTML;
    }
    displayPost();
</script>